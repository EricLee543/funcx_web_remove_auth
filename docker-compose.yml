version: '3.8'
services:
  funcx-web-service:
    build: .
    ports:
      - "8080:8080"
    environment:
      - FLASK_APP=funcx-web-service
      - FLASK_DEBUG=1
    env_file: funcx-web-service.env
    volumes: [".:/opt/funcx-web-service"]
    secrets:
      - globus_client
      - globus_key
  forwarder:
    build: forwarder
    ports:
      - "8081:8080"
    volumes:
      - ./forwarder:/opt/forwarder
  serializer:
    build: serializer
    ports:
      - "8082:8080"
    environment:
      - FLASK_ENV=development
    volumes:
      - ./serializer/serializer:/opt/serializer
  mockrds:
    build: dockers/rds
    ports:
      - "5432:5432"
  mockredis:
    build: dockers/redis
    ports:
      - "6379:6379"
    sysctls:
      net.core.somaxconn: 1024
secrets:
  globus_client:
    file: dockers/secrets/globus_client.txt
  globus_key:
    file: dockers/secrets/globus_key.txt

